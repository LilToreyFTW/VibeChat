{"ast":null,"code":"import{create}from'zustand';import{persist}from'zustand/middleware';import apiService from'../services/api';export const useSubscriptionStore=create()(persist((set,get)=>({subscriptions:[],availableTiers:{},paymentMethods:{},btcWallet:'',isLoading:false,error:null,fetchSubscriptions:async()=>{set({isLoading:true,error:null});try{const response=await apiService.getMySubscriptions();if(response.success&&response.data){set({subscriptions:response.data,isLoading:false,error:null});}else{set({subscriptions:[],isLoading:false,error:response.message||'Failed to fetch subscriptions'});}}catch(error){var _error$response,_error$response$data;set({subscriptions:[],isLoading:false,error:((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Failed to fetch subscriptions'});}},fetchAvailableTiers:async()=>{set({isLoading:true,error:null});try{const response=await apiService.getAvailableTiers();if(response.success&&response.data){set({availableTiers:response.data,isLoading:false,error:null});}else{set({availableTiers:{},isLoading:false,error:response.message||'Failed to fetch tiers'});}}catch(error){var _error$response2,_error$response2$data;set({availableTiers:{},isLoading:false,error:((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||'Failed to fetch tiers'});}},fetchPaymentMethods:async()=>{set({isLoading:true,error:null});try{const response=await apiService.getPaymentMethods();if(response.success&&response.data){set({paymentMethods:response.data,isLoading:false,error:null});}else{set({paymentMethods:{},isLoading:false,error:response.message||'Failed to fetch payment methods'});}// Also fetch BTC wallet\nconst walletResponse=await apiService.getBTCWallet();if(walletResponse.success&&walletResponse.data){set({btcWallet:walletResponse.data.btcWallet});}}catch(error){var _error$response3,_error$response3$data;set({paymentMethods:{},isLoading:false,error:((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||'Failed to fetch payment methods'});}},purchaseSubscription:async data=>{set({isLoading:true,error:null});try{const response=await apiService.purchaseSubscription(data);if(response.success){// Refresh subscriptions\nawait get().fetchSubscriptions();set({isLoading:false,error:null});}else{set({isLoading:false,error:response.message||'Failed to purchase subscription'});}}catch(error){var _error$response4,_error$response4$data;set({isLoading:false,error:((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||'Failed to purchase subscription'});}},cancelSubscription:async subscriptionId=>{set({isLoading:true,error:null});try{const response=await apiService.cancelSubscription(subscriptionId);if(response.success){// Refresh subscriptions\nawait get().fetchSubscriptions();set({isLoading:false,error:null});}else{set({isLoading:false,error:response.message||'Failed to cancel subscription'});}}catch(error){var _error$response5,_error$response5$data;set({isLoading:false,error:((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.message)||'Failed to cancel subscription'});}},clearError:()=>{set({error:null});},setLoading:loading=>{set({isLoading:loading});}}),{name:'subscription-storage',partialize:state=>({subscriptions:state.subscriptions,availableTiers:state.availableTiers})}));","map":{"version":3,"names":["create","persist","apiService","useSubscriptionStore","set","get","subscriptions","availableTiers","paymentMethods","btcWallet","isLoading","error","fetchSubscriptions","response","getMySubscriptions","success","data","message","_error$response","_error$response$data","fetchAvailableTiers","getAvailableTiers","_error$response2","_error$response2$data","fetchPaymentMethods","getPaymentMethods","walletResponse","getBTCWallet","_error$response3","_error$response3$data","purchaseSubscription","_error$response4","_error$response4$data","cancelSubscription","subscriptionId","_error$response5","_error$response5$data","clearError","setLoading","loading","name","partialize","state"],"sources":["I:/VibeChat/frontend/src/store/subscriptionStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\nimport { Subscription, TierInfo, CreateSubscriptionRequest } from '../types';\r\nimport apiService from '../services/api';\r\n\r\ninterface SubscriptionState {\r\n  subscriptions: Subscription[];\r\n  availableTiers: Record<string, TierInfo>;\r\n  paymentMethods: Record<string, any>;\r\n  btcWallet: string;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n\r\n  // Actions\r\n  fetchSubscriptions: () => Promise<void>;\r\n  fetchAvailableTiers: () => Promise<void>;\r\n  fetchPaymentMethods: () => Promise<void>;\r\n  purchaseSubscription: (data: CreateSubscriptionRequest) => Promise<void>;\r\n  cancelSubscription: (subscriptionId: number) => Promise<void>;\r\n  clearError: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n}\r\n\r\nexport const useSubscriptionStore = create<SubscriptionState>()(\r\n  persist(\r\n    (set, get) => ({\r\n      subscriptions: [],\r\n      availableTiers: {},\r\n      paymentMethods: {},\r\n      btcWallet: '',\r\n      isLoading: false,\r\n      error: null,\r\n\r\n      fetchSubscriptions: async () => {\r\n        set({ isLoading: true, error: null });\r\n\r\n        try {\r\n          const response = await apiService.getMySubscriptions();\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              subscriptions: response.data,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n          } else {\r\n            set({\r\n              subscriptions: [],\r\n              isLoading: false,\r\n              error: response.message || 'Failed to fetch subscriptions',\r\n            });\r\n          }\r\n        } catch (error: any) {\r\n          set({\r\n            subscriptions: [],\r\n            isLoading: false,\r\n            error: error.response?.data?.message || 'Failed to fetch subscriptions',\r\n          });\r\n        }\r\n      },\r\n\r\n      fetchAvailableTiers: async () => {\r\n        set({ isLoading: true, error: null });\r\n\r\n        try {\r\n          const response = await apiService.getAvailableTiers();\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              availableTiers: response.data,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n          } else {\r\n            set({\r\n              availableTiers: {},\r\n              isLoading: false,\r\n              error: response.message || 'Failed to fetch tiers',\r\n            });\r\n          }\r\n        } catch (error: any) {\r\n          set({\r\n            availableTiers: {},\r\n            isLoading: false,\r\n            error: error.response?.data?.message || 'Failed to fetch tiers',\r\n          });\r\n        }\r\n      },\r\n\r\n      fetchPaymentMethods: async () => {\r\n        set({ isLoading: true, error: null });\r\n\r\n        try {\r\n          const response = await apiService.getPaymentMethods();\r\n\r\n          if (response.success && response.data) {\r\n            set({\r\n              paymentMethods: response.data,\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n          } else {\r\n            set({\r\n              paymentMethods: {},\r\n              isLoading: false,\r\n              error: response.message || 'Failed to fetch payment methods',\r\n            });\r\n          }\r\n\r\n          // Also fetch BTC wallet\r\n          const walletResponse = await apiService.getBTCWallet();\r\n          if (walletResponse.success && walletResponse.data) {\r\n            set({\r\n              btcWallet: walletResponse.data.btcWallet,\r\n            });\r\n          }\r\n        } catch (error: any) {\r\n          set({\r\n            paymentMethods: {},\r\n            isLoading: false,\r\n            error: error.response?.data?.message || 'Failed to fetch payment methods',\r\n          });\r\n        }\r\n      },\r\n\r\n      purchaseSubscription: async (data: CreateSubscriptionRequest) => {\r\n        set({ isLoading: true, error: null });\r\n\r\n        try {\r\n          const response = await apiService.purchaseSubscription(data);\r\n\r\n          if (response.success) {\r\n            // Refresh subscriptions\r\n            await get().fetchSubscriptions();\r\n            set({\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n          } else {\r\n            set({\r\n              isLoading: false,\r\n              error: response.message || 'Failed to purchase subscription',\r\n            });\r\n          }\r\n        } catch (error: any) {\r\n          set({\r\n            isLoading: false,\r\n            error: error.response?.data?.message || 'Failed to purchase subscription',\r\n          });\r\n        }\r\n      },\r\n\r\n      cancelSubscription: async (subscriptionId: number) => {\r\n        set({ isLoading: true, error: null });\r\n\r\n        try {\r\n          const response = await apiService.cancelSubscription(subscriptionId);\r\n\r\n          if (response.success) {\r\n            // Refresh subscriptions\r\n            await get().fetchSubscriptions();\r\n            set({\r\n              isLoading: false,\r\n              error: null,\r\n            });\r\n          } else {\r\n            set({\r\n              isLoading: false,\r\n              error: response.message || 'Failed to cancel subscription',\r\n            });\r\n          }\r\n        } catch (error: any) {\r\n          set({\r\n            isLoading: false,\r\n            error: error.response?.data?.message || 'Failed to cancel subscription',\r\n          });\r\n        }\r\n      },\r\n\r\n      clearError: () => {\r\n        set({ error: null });\r\n      },\r\n\r\n      setLoading: (loading: boolean) => {\r\n        set({ isLoading: loading });\r\n      },\r\n    }),\r\n    {\r\n      name: 'subscription-storage',\r\n      partialize: (state) => ({\r\n        subscriptions: state.subscriptions,\r\n        availableTiers: state.availableTiers,\r\n      }),\r\n    }\r\n  )\r\n);\r\n"],"mappings":"AAAA,OAASA,MAAM,KAAQ,SAAS,CAChC,OAASC,OAAO,KAAQ,oBAAoB,CAE5C,MAAO,CAAAC,UAAU,KAAM,iBAAiB,CAoBxC,MAAO,MAAM,CAAAC,oBAAoB,CAAGH,MAAM,CAAoB,CAAC,CAC7DC,OAAO,CACL,CAACG,GAAG,CAAEC,GAAG,IAAM,CACbC,aAAa,CAAE,EAAE,CACjBC,cAAc,CAAE,CAAC,CAAC,CAClBC,cAAc,CAAE,CAAC,CAAC,CAClBC,SAAS,CAAE,EAAE,CACbC,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IAAI,CAEXC,kBAAkB,CAAE,KAAAA,CAAA,GAAY,CAC9BR,GAAG,CAAC,CAAEM,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAErC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,UAAU,CAACY,kBAAkB,CAAC,CAAC,CAEtD,GAAID,QAAQ,CAACE,OAAO,EAAIF,QAAQ,CAACG,IAAI,CAAE,CACrCZ,GAAG,CAAC,CACFE,aAAa,CAAEO,QAAQ,CAACG,IAAI,CAC5BN,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACLP,GAAG,CAAC,CACFE,aAAa,CAAE,EAAE,CACjBI,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEE,QAAQ,CAACI,OAAO,EAAI,+BAC7B,CAAC,CAAC,CACJ,CACF,CAAE,MAAON,KAAU,CAAE,KAAAO,eAAA,CAAAC,oBAAA,CACnBf,GAAG,CAAC,CACFE,aAAa,CAAE,EAAE,CACjBI,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,EAAAO,eAAA,CAAAP,KAAK,CAACE,QAAQ,UAAAK,eAAA,kBAAAC,oBAAA,CAAdD,eAAA,CAAgBF,IAAI,UAAAG,oBAAA,iBAApBA,oBAAA,CAAsBF,OAAO,GAAI,+BAC1C,CAAC,CAAC,CACJ,CACF,CAAC,CAEDG,mBAAmB,CAAE,KAAAA,CAAA,GAAY,CAC/BhB,GAAG,CAAC,CAAEM,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAErC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,UAAU,CAACmB,iBAAiB,CAAC,CAAC,CAErD,GAAIR,QAAQ,CAACE,OAAO,EAAIF,QAAQ,CAACG,IAAI,CAAE,CACrCZ,GAAG,CAAC,CACFG,cAAc,CAAEM,QAAQ,CAACG,IAAI,CAC7BN,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACLP,GAAG,CAAC,CACFG,cAAc,CAAE,CAAC,CAAC,CAClBG,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEE,QAAQ,CAACI,OAAO,EAAI,uBAC7B,CAAC,CAAC,CACJ,CACF,CAAE,MAAON,KAAU,CAAE,KAAAW,gBAAA,CAAAC,qBAAA,CACnBnB,GAAG,CAAC,CACFG,cAAc,CAAE,CAAC,CAAC,CAClBG,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,EAAAW,gBAAA,CAAAX,KAAK,CAACE,QAAQ,UAAAS,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBN,IAAI,UAAAO,qBAAA,iBAApBA,qBAAA,CAAsBN,OAAO,GAAI,uBAC1C,CAAC,CAAC,CACJ,CACF,CAAC,CAEDO,mBAAmB,CAAE,KAAAA,CAAA,GAAY,CAC/BpB,GAAG,CAAC,CAAEM,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAErC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,UAAU,CAACuB,iBAAiB,CAAC,CAAC,CAErD,GAAIZ,QAAQ,CAACE,OAAO,EAAIF,QAAQ,CAACG,IAAI,CAAE,CACrCZ,GAAG,CAAC,CACFI,cAAc,CAAEK,QAAQ,CAACG,IAAI,CAC7BN,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACLP,GAAG,CAAC,CACFI,cAAc,CAAE,CAAC,CAAC,CAClBE,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEE,QAAQ,CAACI,OAAO,EAAI,iCAC7B,CAAC,CAAC,CACJ,CAEA;AACA,KAAM,CAAAS,cAAc,CAAG,KAAM,CAAAxB,UAAU,CAACyB,YAAY,CAAC,CAAC,CACtD,GAAID,cAAc,CAACX,OAAO,EAAIW,cAAc,CAACV,IAAI,CAAE,CACjDZ,GAAG,CAAC,CACFK,SAAS,CAAEiB,cAAc,CAACV,IAAI,CAACP,SACjC,CAAC,CAAC,CACJ,CACF,CAAE,MAAOE,KAAU,CAAE,KAAAiB,gBAAA,CAAAC,qBAAA,CACnBzB,GAAG,CAAC,CACFI,cAAc,CAAE,CAAC,CAAC,CAClBE,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,EAAAiB,gBAAA,CAAAjB,KAAK,CAACE,QAAQ,UAAAe,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBZ,IAAI,UAAAa,qBAAA,iBAApBA,qBAAA,CAAsBZ,OAAO,GAAI,iCAC1C,CAAC,CAAC,CACJ,CACF,CAAC,CAEDa,oBAAoB,CAAE,KAAO,CAAAd,IAA+B,EAAK,CAC/DZ,GAAG,CAAC,CAAEM,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAErC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,UAAU,CAAC4B,oBAAoB,CAACd,IAAI,CAAC,CAE5D,GAAIH,QAAQ,CAACE,OAAO,CAAE,CACpB;AACA,KAAM,CAAAV,GAAG,CAAC,CAAC,CAACO,kBAAkB,CAAC,CAAC,CAChCR,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACLP,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEE,QAAQ,CAACI,OAAO,EAAI,iCAC7B,CAAC,CAAC,CACJ,CACF,CAAE,MAAON,KAAU,CAAE,KAAAoB,gBAAA,CAAAC,qBAAA,CACnB5B,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,EAAAoB,gBAAA,CAAApB,KAAK,CAACE,QAAQ,UAAAkB,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBf,IAAI,UAAAgB,qBAAA,iBAApBA,qBAAA,CAAsBf,OAAO,GAAI,iCAC1C,CAAC,CAAC,CACJ,CACF,CAAC,CAEDgB,kBAAkB,CAAE,KAAO,CAAAC,cAAsB,EAAK,CACpD9B,GAAG,CAAC,CAAEM,SAAS,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAC,CAErC,GAAI,CACF,KAAM,CAAAE,QAAQ,CAAG,KAAM,CAAAX,UAAU,CAAC+B,kBAAkB,CAACC,cAAc,CAAC,CAEpE,GAAIrB,QAAQ,CAACE,OAAO,CAAE,CACpB;AACA,KAAM,CAAAV,GAAG,CAAC,CAAC,CAACO,kBAAkB,CAAC,CAAC,CAChCR,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,IACT,CAAC,CAAC,CACJ,CAAC,IAAM,CACLP,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAEE,QAAQ,CAACI,OAAO,EAAI,+BAC7B,CAAC,CAAC,CACJ,CACF,CAAE,MAAON,KAAU,CAAE,KAAAwB,gBAAA,CAAAC,qBAAA,CACnBhC,GAAG,CAAC,CACFM,SAAS,CAAE,KAAK,CAChBC,KAAK,CAAE,EAAAwB,gBAAA,CAAAxB,KAAK,CAACE,QAAQ,UAAAsB,gBAAA,kBAAAC,qBAAA,CAAdD,gBAAA,CAAgBnB,IAAI,UAAAoB,qBAAA,iBAApBA,qBAAA,CAAsBnB,OAAO,GAAI,+BAC1C,CAAC,CAAC,CACJ,CACF,CAAC,CAEDoB,UAAU,CAAEA,CAAA,GAAM,CAChBjC,GAAG,CAAC,CAAEO,KAAK,CAAE,IAAK,CAAC,CAAC,CACtB,CAAC,CAED2B,UAAU,CAAGC,OAAgB,EAAK,CAChCnC,GAAG,CAAC,CAAEM,SAAS,CAAE6B,OAAQ,CAAC,CAAC,CAC7B,CACF,CAAC,CAAC,CACF,CACEC,IAAI,CAAE,sBAAsB,CAC5BC,UAAU,CAAGC,KAAK,GAAM,CACtBpC,aAAa,CAAEoC,KAAK,CAACpC,aAAa,CAClCC,cAAc,CAAEmC,KAAK,CAACnC,cACxB,CAAC,CACH,CACF,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}